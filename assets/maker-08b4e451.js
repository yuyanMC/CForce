import{v as T,a as ke,b as K}from"./runtime-dom.esm-bundler-8b9251e4.js";import Ae from"./hit-556a07c1.js";import{EnhancedContent as be,TextCanvasObject as ye,RGBAColor as c,NoteCanvasObject as M,ClackLineCanvasObject as Ce}from"./gui-d002ad5e.js";import{EventBus as Ne}from"./event-4329e05e.js";import{Chart as Z,Note as q,nullPath as ee,StaticPath as I,LinePath as te,ArcPath as ae,Pow2SPath as ne}from"./chart-86b8c9aa.js";import{DynamicLoader as se}from"./network-b372e317.js";import{EnhancedAudioContext as xe,SoundManager as $e}from"./sound-37c3646d.js";import{s as Te,t as f,C as H,u as Ie,v as p,w as a,F as R,D as j,y as E,E as D,G as g,x as L,B as h,H as le,I as Ee,J as Ue,_ as Se}from"./_plugin-vue_export-helper-1dca6b40.js";import"./util-720ff2c1.js";const l=U=>(Ee("data-v-0bea1021"),U=U(),Ue(),U),Be={id:"innerBox"},Ve=l(()=>a("canvas",{id:"main_canvas",width:"3200",height:"1800"},null,-1)),Pe=[Ve],Me={key:0,id:"notes"},De=["onClick"],Le={class:"showNote"},Fe=["fill"],Oe=l(()=>a("circle",{r:"2em",cx:"2.5em",cy:"2.5em",fill:"#00000000",stroke:"white","stroke-width":"0.05em"},null,-1)),He={class:"noteTag"},Re=l(()=>a("span",{class:"noteTrack"},"Track",-1)),je=["onUpdate:modelValue"],We=l(()=>a("option",{value:"A"},"A",-1)),ze=l(()=>a("option",{value:"B"},"B",-1)),Ge=[We,ze],Je=l(()=>a("span",{class:"noteHitTime"},"Hit Time",-1)),Qe=["onUpdate:modelValue"],Xe=["onClick"],Ye={key:1,id:"notes"},Ke=["onClick"],Ze={class:"showNote"},qe=["fill"],et=l(()=>a("circle",{r:"2em",cx:"2.5em",cy:"2.5em",fill:"#00000000",stroke:"white","stroke-width":"0.05em"},null,-1)),tt={class:"noteTag"},at=l(()=>a("span",{class:"noteTrack"},"Fill",-1)),nt=["value","onChange"],st=l(()=>a("span",{class:"noteHitTime"},"Hit Time",-1)),lt=["onUpdate:modelValue"],ot=["onClick"],it={key:2,id:"notes"},ut={class:"noteTag"},ct=l(()=>a("span",{class:"noteTrack"},"Type",-1)),rt=["value","onChange"],dt=l(()=>a("option",{value:"static"},"Static",-1)),pt=l(()=>a("option",{value:"line"},"Line",-1)),ht=l(()=>a("option",{value:"arc"},"Arc",-1)),vt=l(()=>a("option",{value:"pow2"},"^2",-1)),_t=[dt,pt,ht,vt],ft=l(()=>a("span",{class:"noteHitTime"},"Length",-1)),mt=["onUpdate:modelValue"],wt=["onClick"],gt={id:"dataBox"},kt=l(()=>a("span",null,"Sec: ",-1)),At=l(()=>a("br",null,null,-1)),bt=l(()=>a("span",null,"Paused: ",-1)),yt=l(()=>a("br",null,null,-1)),Ct=l(()=>a("span",null,"Chart: ",-1)),Nt=l(()=>a("br",null,null,-1)),xt=l(()=>a("span",null,"Upload Music: ",-1)),$t=l(()=>a("br",null,null,-1)),Tt=l(()=>a("span",null,"Upload Background: ",-1)),It=l(()=>a("br",null,null,-1)),Et=l(()=>a("span",null,"Bar: ",-1)),Ut=l(()=>a("option",{value:"N"},"Notes",-1)),St=l(()=>a("option",{value:"AN"},"Animation Notes",-1)),Bt=l(()=>a("option",{value:"PE"},"Path Editor",-1)),Vt=[Ut,St,Bt],Pt=l(()=>a("br",null,null,-1)),Mt=l(()=>a("br",null,null,-1)),Dt=l(()=>a("br",null,null,-1)),Lt=Te({__name:"maker",setup(U){const A=f("N");let oe=new se("images"),W=new se("sounds"),C;const u=f(new Z({notes:[],animationNotes:[],bgsound:"maker.mp3",length:3600}));let v=60,S,r=new xe(new AudioContext),ie=.5,ue=.5,k=0;const B=f(!1),b=H({get:()=>B.value,set:e=>{e!=B.value&&(e?(r.pause(),B.value=!0):(r.play(i.value),B.value=!1))}});let V=[];const N=f(0),i=f(0);let P=0,d,F=1e5,m=new Ne,x=f({notes:[],animationNotes:[],bgsound:"maker.mp3",length:3600});const z=f(null),G=f(null),ce=f(null),J=f(null),_=f("none");function w(e,t,n,o="left",s=50,O=new c(255,255,255)){d.render(new ye(e,t,n,o,s,O instanceof c?O:new c(255,255,255,O)))}function Q(e){if(e.a||(i.value-e.h+e.p.spd)/e.p.spd<0||(i.value-e.h+e.p.spd)/e.p.spd>1)return;let t=e.p.cal((i.value-e.h+e.p.spd)/e.p.spd),n=new c(e.f[0],e.f[1],e.f[2]);d.render(new M(...t,n))}function re(e){e.y=="A"&&((i.value-e.h+e.p.spd)/e.p.spd<0||(i.value-e.al-e.h+e.p.spd)/e.p.spd>1||d.render(new Ce(e.p,(i.value-e.al-e.h+e.p.spd)/e.p.spd,(i.value-e.h+e.p.spd)/e.p.spd)))}function X(e){if(e.a<=0)return;let t=i.value-e.aa,n=e.p.cal((e.aa-e.h+e.p.spd)/e.p.spd);if(e.a==12&&t<e.hi){let o=t/e.hi+1,s=new c(e.f[0],e.f[1],e.f[2],o-1);d.render(new M(...n,s))}else if(e.a==11&&t<e.ho){let o=t/e.ho+1,s=new c(e.f[0],e.f[1],e.f[2],2-o);d.render(new M(...n,s))}else if(e.a>0&&t<.25){let o=t/.25+1,s=new c(0,0,0,0);e.a==1?s=new c(160,144,0,2-o):e.a==2&&(s=new c(0,167,195,2-o)),d.render(new M(...n,s,o*88))}}function de(){C.fillStyle="rgb(255,255,255)",C.font="50px 'Courier New'",C.textAlign="center",w(`${k}`,1600,60,"center"),w("COMBO",1600,120,"center"),w(`Point: ${(k/u.value.notes.length*1e5).toFixed(0)}`,3150,60,"right"),w(`Music: ${(i.value/u.value.length*100).toFixed(2)}%`,3150,120,"right");{let e=V.length,t=new c(255,0,255);e/v>=0&&(t=new c(255,0,255)),e/v>.3&&(t=new c(255,0,63)),e/v>.6&&(t=new c(255,0,0)),e/v>.9&&(t=new c(255,127,0)),e/v>.95&&(t=new c(255,255,0)),e/v>.999&&(t=new c(0,255,0)),e/v>.99999&&(t=new c(0,255,255)),w(`TPS: ${e.toFixed(0)}/${v}`,3150,180,"right",50,t),w(`Sec: ${i.value.toFixed(3)} Paused: ${P.toFixed(3)} Total: ${((Date.now()-N.value)/1e3).toFixed(3)} Music: ${r.actx.currentTime.toFixed(3)}`,3150,240,"right")}}function pe(){d.clear()}Ie(async()=>{document.getElementById("canvas_box").style.backgroundImage=`url(${await oe.loadAsUrl("maker.png").catch(()=>"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P4DwQACfsD/Z8fLAAAAAAASUVORK5CYII=")})`,C=document.getElementById("main_canvas").getContext("2d"),d=new be(C),d.setBackGroundColor("rgba(0,0,0,0.5)"),d.clear(),w("游戏正在加载",1600,900,"center",200,new c(200,200,200)),m.on("hit",()=>{k++}),m.on("hit",()=>{S.play()}),m.on("tick",()=>{let t=Date.now();for(V.push(t);t-V[0]>=1e3;)V.splice(0,1)}),m.on("start",()=>{N.value=Date.now()-r.actx.currentTime*1e3}),d.clear(),w("加载中",1600,900,"center",200,new c(250,250,250)),S=new $e(Ae),await r.actx.suspend(),await S.load(),await r.load(await W.loadAsUrl(x.value.bgsound)),r.setVolume(ue),S.setVolume(ie),m.on("start",()=>{setInterval(async function(){if(b.value){P=(Date.now()-N.value)/1e3-i.value;return}pe(),i.value=(Date.now()-N.value)/1e3-P,m.emit("tick",i.value),u.value.animationNotes.forEach(t=>{t.a==12&&i.value-t.aa>t.hi?(t.a=0,t.aa=0):Math.abs(t.h-i.value)<=1.5/v?t.ho&&(t.a=11,t.aa=i.value):t.hi!=null&&Math.abs(t.h-t.p.spd-t.hi-i.value)<=1.5/v&&(t.a=12,t.aa=i.value),Q(t),X(t)}),u.value.notes.forEach(t=>{re(t)}),u.value.notes.forEach(t=>{!t.a&&Math.abs(t.h-i.value)<1.5/v?(t.a=1,t.aa=t.h,m.emit("hit",1)):i.value-t.h>.16&&!t.a&&(t.a=-1,m.emit("miss",null)),Q(t)}),u.value.notes.forEach(t=>{X(t)}),de(),i.value>=x.value.length&&($.value=0)},1e3/v)}),d.clear(),await r.actx.resume(),r.play(0),m.emit("start",null)});const $=H({get:()=>i.value,set:e=>{u.value.notes.forEach(t=>{t.a=0,t.aa=0}),u.value.animationNotes.forEach(t=>{t.a=0,t.aa=0}),k=0,u.value.notes.forEach(t=>{t.h<e&&k++}),r.pause(),N.value=Date.now()-e*1e3,P=0,r.play(e)}}),Y=H({get:()=>JSON.stringify(x.value),set:async e=>{let t;try{t=JSON.parse(e)}catch(n){console.error(n);return}u.value=new Z(t),k=0,u.value.notes.forEach(n=>{n.h<i.value&&k++});try{r.pause()}catch(n){console.error(n)}t.bgsound!=x.value.bgsound&&(b.value=!0,d.clear(),w("加载中",1600,900,"center",200,new c(250,250,250)),await r.load(await W.loadAsUrl(t.bgsound)),d.clear()),x.value=t,$.value=0}});function he(){let e=URL.createObjectURL(G.value.files[0]);console.log(e),J.value.style.backgroundImage=`url(${e})`}function ve(){let e=URL.createObjectURL(z.value.files[0]);console.log(e),r.load(e)}function _e(e,t){let n=e.target.value;t.f=[parseInt(n.slice(1,3),16),parseInt(n.slice(3,5),16),parseInt(n.slice(5,7),16)]}function fe(e){if(e=="none")return"<<CURRENTLY NONE>>";if(e.startsWith("N"))return`Note ${parseInt(e.slice(1))+1}`;if(e.startsWith("AN"))return`Animation Note ${parseInt(e.slice(2))+1}`}function y(e){if(e=="none")return null;if(e.startsWith("N"))return u.value.notes[parseInt(e.slice(1))];if(e.startsWith("AN"))return u.value.animationNotes[parseInt(e.slice(2))]}function me(e){if(e instanceof I)return"static";if(e instanceof te)return"line";if(e instanceof ae)return"arc";if(e instanceof ne)return"pow2";throw new Error("Invalid Path")}function we(e,t){let n=t.target.value,o=y(_.value).p.ps[e].spd,s=new I(o,1600,900);n=="static"&&(s=new I(o,1600,900)),n=="line"&&(s=new te(o,0,0,1600,900)),n=="arc"&&(s=new ae(o,0,0,-1600,900,1600,900)),n=="pow2"&&(s=new ne(new I(o,1600,900))),y(_.value).p.ps[e]=s}function ge(){F=y(_.value).h;let e=y(_.value).p.spd;b.value=!1,$.value=e}return m.on("tick",e=>{e>F&&(b.value=!0,F=1e5)}),(e,t)=>(h(),p("div",{id:"gameBox",ref_key:"gamebox",ref:ce},[a("div",Be,[a("div",{id:"canvas_box",ref_key:"canvasbox",ref:J},Pe,512),A.value=="N"?(h(),p("ul",Me,[(h(!0),p(R,null,j(u.value.notes,(n,o)=>(h(),p("li",{class:le({selected:_.value==`N${o}`}),onClick:s=>_.value=`N${o}`},[(h(),p("svg",Le,[a("circle",{r:"2.2em",cx:"2.5em",cy:"2.5em",fill:`rgb(${n.f[0]},${n.f[1]},${n.f[2]})`,"stroke-width":"0"},null,8,Fe),Oe])),a("span",He,"Note #"+L(o+1),1),Re,g(a("select",{class:"noteTrackInput","onUpdate:modelValue":s=>n.t=s},Ge,8,je),[[K,n.t]]),Je,g(a("input",{class:"noteHitTimeInput","onUpdate:modelValue":s=>n.h=s,type:"text"},null,8,Qe),[[T,n.h,void 0,{number:!0}]]),a("span",{class:"noteDelete",onClick:s=>u.value.notes.splice(o,1)},"X",8,Xe)],10,De))),256)),a("li",{id:"add",onClick:t[0]||(t[0]=n=>u.value.notes.push(new E(q)(E(ee)(),0,"A","I",0)))}," + ")])):D("",!0),A.value=="AN"?(h(),p("ul",Ye,[(h(!0),p(R,null,j(u.value.animationNotes,(n,o)=>(h(),p("li",{class:le({selected:_.value==`AN${o}`}),onClick:s=>_.value=`AN${o}`},[(h(),p("svg",Ze,[a("circle",{r:"2.2em",cx:"2.5em",cy:"2.5em",fill:`rgb(${n.f[0]},${n.f[1]},${n.f[2]})`,"stroke-width":"0"},null,8,qe),et])),a("span",tt,"Animation Note #"+L(o+1),1),at,a("input",{class:"noteFillInput",type:"color",value:`#${n.f[0].toString(16)}${n.f[1].toString(16)}${n.f[2].toString(16)}`,onChange:s=>{_e(s,n)}},null,40,nt),st,g(a("input",{class:"noteHitTimeInput","onUpdate:modelValue":s=>n.h=s,type:"text"},null,8,lt),[[T,n.h,void 0,{number:!0}]]),a("span",{class:"noteDelete",onClick:s=>u.value.animationNotes.splice(o,1)},"X",8,ot)],10,Ke))),256)),a("li",{id:"add",onClick:t[1]||(t[1]=n=>u.value.animationNotes.push(new E(q)(E(ee)(),0,"M","I",0,[64,64,64])))}," + ")])):D("",!0),A.value=="PE"?(h(),p("ul",it,[(h(!0),p(R,null,j(y(_.value).p.ps,(n,o)=>(h(),p("li",null,[a("span",ut,"Path #"+L(o+1),1),ct,a("select",{class:"pathTrackInput",value:me(n),onChange:s=>we(o,s)},_t,40,rt),ft,g(a("input",{class:"noteHitTimeInput","onUpdate:modelValue":s=>n.spd=s,type:"text"},null,8,mt),[[T,n.spd,void 0,{number:!0,lazy:!0}]]),a("span",{class:"noteDelete",onClick:s=>u.value.animationNotes.splice(o,1)},"X",8,wt)]))),256)),a("li",{id:"add",onClick:t[2]||(t[2]=n=>y(_.value).p.ps.push(new E(I)(1e-4,1600,900)))}," + ")])):D("",!0),a("div",gt,[kt,g(a("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>$.value=n)},null,512),[[T,$.value,void 0,{lazy:!0}]]),At,bt,g(a("input",{id:"pause",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=n=>b.value=n)},null,512),[[ke,b.value]]),yt,Ct,g(a("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>Y.value=n)},null,512),[[T,Y.value]]),Nt,xt,a("input",{type:"file",accept:"audio/*",ref_key:"music",ref:z,onChange:ve},null,544),$t,Tt,a("input",{type:"file",accept:"image/*",ref_key:"bg",ref:G,onChange:he},null,544),It,Et,g(a("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>A.value=n)},Vt,512),[[K,A.value,void 0,{lazy:!0}]]),Pt,a("span",null,"Current: "+L(fe(_.value)),1),Mt,A.value=="PE"?(h(),p("button",{key:0,onClick:ge},"Preview")):D("",!0),Dt])])],512))}});const Qt=Se(Lt,[["__scopeId","data-v-0bea1021"]]);export{Qt as default};
