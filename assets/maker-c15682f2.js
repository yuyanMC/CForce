import{v as r,a as Ce,b as te}from"./runtime-dom.esm-bundler-47361fad.js";import{h as Ue,b as Ve}from"./blank-9706cc97.js";import{EnhancedContent as Ne,TextCanvasObject as Ie,RGBAColor as d,NoteCanvasObject as D,ClackLineCanvasObject as Pe}from"./gui-d002ad5e.js";import{EventBus as Te}from"./event-4329e05e.js";import{Chart as ae,Note as ne,MultiPath as oe,StaticPath as k,LinePath as F,ArcPath as H,Pow2SPath as W}from"./chart-27dff426.js";import{EnhancedAudioContext as Ee,SoundManager as $e}from"./sound-37c3646d.js";import{s as Se,t as g,C as O,u as Be,v as p,w as n,F as V,D as G,E as x,G as u,x as R,B as h,H as se,y as J,I as _,J as ze,K as Me,_ as Le}from"./_plugin-vue_export-helper-e5125ee4.js";import"./util-dc03d8d1.js";const s=E=>(ze("data-v-151a7ee4"),E=E(),Me(),E),De={id:"innerBox"},Fe=s(()=>n("canvas",{id:"main_canvas",width:"3200",height:"1800"},null,-1)),He=[Fe],Oe={key:0,id:"notes"},Re=["onClick"],je={class:"showNote"},We=["fill"],Ge=s(()=>n("circle",{r:"2em",cx:"2.5em",cy:"2.5em",fill:"#00000000",stroke:"white","stroke-width":"0.05em"},null,-1)),Je={class:"noteTag"},Ke=s(()=>n("span",{class:"noteTrack"},"Track",-1)),Qe=["onUpdate:modelValue"],Xe=s(()=>n("option",{value:"A"},"A",-1)),Ye=s(()=>n("option",{value:"B"},"B",-1)),Ze=[Xe,Ye],qe=s(()=>n("span",{class:"noteHitTime"},"Hit Time",-1)),et=s(()=>n("span",{class:"noteClack"},"Clack Note",-1)),tt=["checked","onChange"],at={key:0,class:"noteClackTime"},nt=["onUpdate:modelValue"],ot=["onUpdate:modelValue"],st=["onClick"],lt={key:1,id:"notes"},it=["onClick"],ut={class:"showNote"},ct=["fill"],rt=s(()=>n("circle",{r:"2em",cx:"2.5em",cy:"2.5em",fill:"#00000000",stroke:"white","stroke-width":"0.05em"},null,-1)),dt={class:"noteTag"},pt=s(()=>n("span",{class:"noteTrack"},"Fill",-1)),ht=["value","onChange"],_t=s(()=>n("span",{class:"noteHitTime"},"Hit Time",-1)),ft=["onUpdate:modelValue"],vt=["onClick"],mt={key:2,id:"notes"},yt={class:"noteTag"},gt=s(()=>n("span",{class:"noteTrack"},"Type",-1)),wt=["value","onChange"],kt=s(()=>n("option",{value:"static"},"Static",-1)),xt=s(()=>n("option",{value:"line"},"Line",-1)),bt=s(()=>n("option",{value:"arc"},"Arc",-1)),At=s(()=>n("option",{value:"pow2"},"^2",-1)),Ct=[kt,xt,bt,At],Ut={class:"pathPosition"},Vt=["onUpdate:modelValue"],Nt=["onUpdate:modelValue"],It=s(()=>n("span",{class:"noteHitTime"},"Length",-1)),Pt=["onUpdate:modelValue"],Tt={class:"pathPosition"},Et=["onUpdate:modelValue"],$t=["onUpdate:modelValue"],St=["onUpdate:modelValue"],Bt=["onUpdate:modelValue"],zt=s(()=>n("span",{class:"noteHitTime"},"Length",-1)),Mt=["onUpdate:modelValue"],Lt={class:"pathPosition arcEdit"},Dt=["onUpdate:modelValue"],Ft=["onUpdate:modelValue"],Ht=["onUpdate:modelValue"],Ot=["onUpdate:modelValue"],Rt=["onUpdate:modelValue"],jt=["onUpdate:modelValue"],Wt=s(()=>n("span",{class:"noteHitTime"},"Length",-1)),Gt=["onUpdate:modelValue"],Jt=["onClick"],Kt={id:"dataBox"},Qt=s(()=>n("span",null,"Sec: ",-1)),Xt=s(()=>n("br",null,null,-1)),Yt=s(()=>n("span",null,"Paused: ",-1)),Zt=s(()=>n("br",null,null,-1)),qt=s(()=>n("span",null,"Chart: ",-1)),ea=s(()=>n("br",null,null,-1)),ta=s(()=>n("span",null,"Upload Music: ",-1)),aa=s(()=>n("br",null,null,-1)),na=s(()=>n("span",null,"Upload Background: ",-1)),oa=s(()=>n("br",null,null,-1)),sa=s(()=>n("span",null,"Bar: ",-1)),la=s(()=>n("option",{value:"N"},"Notes",-1)),ia=s(()=>n("option",{value:"AN"},"Animation Notes",-1)),ua=s(()=>n("option",{value:"PE"},"Path Editor",-1)),ca=[la,ia,ua],ra=s(()=>n("br",null,null,-1)),da=s(()=>n("br",null,null,-1)),pa=s(()=>n("br",null,null,-1)),ha=Se({__name:"maker",setup(E){const C=g("N");let N;const c=g(new ae({notes:[],animationNotes:[],length:3600}));let f=60,$,v=new Ee(new AudioContext),le=.5,ie=.5,I=0;const S=g(!1),U=O({get:()=>S.value,set:e=>{e!=S.value&&(e?(v.pause(),S.value=!0):(v.play(i.value),S.value=!1))}});let B=[];const P=g(0),i=g(0);let z=0,m,M=1e5,w=new Te,ue=g({notes:[],animationNotes:[],bgsound:"maker.mp3",length:3600});const K=g(null),Q=g(null),ce=g(null),X=g(null),y=g("none");function b(e,t,a,l="left",o=50,j=new d(255,255,255)){m.render(new Ie(e,t,a,l,o,j instanceof d?j:new d(255,255,255,j)))}function Y(e){if(e.a||(i.value-e.h+e.p.spd)/e.p.spd<0||(i.value-e.h+e.p.spd)/e.p.spd>1)return;let t=e.p.cal((i.value-e.h+e.p.spd)/e.p.spd),a=new d(e.f[0],e.f[1],e.f[2]);m.render(new D(...t,a))}function re(e){e.y=="A"&&((i.value-e.h+e.p.spd)/e.p.spd<0||(i.value-e.al-e.h+e.p.spd)/e.p.spd>1||m.render(new Pe(e.p,(i.value-e.al-e.h+e.p.spd)/e.p.spd,(i.value-e.h+e.p.spd)/e.p.spd)))}function Z(e){if(e.a<=0)return;let t=i.value-e.aa,a=e.p.cal((e.aa-e.h+e.p.spd)/e.p.spd);if(e.a==12&&t<e.hi){let l=t/e.hi+1,o=new d(e.f[0],e.f[1],e.f[2],l-1);m.render(new D(...a,o))}else if(e.a==11&&t<e.ho){let l=t/e.ho+1,o=new d(e.f[0],e.f[1],e.f[2],2-l);m.render(new D(...a,o))}else if(e.a>0&&t<.25){let l=t/.25+1,o=new d(0,0,0,0);e.a==1?o=new d(160,144,0,2-l):e.a==2&&(o=new d(0,167,195,2-l)),m.render(new D(...a,o,l*88))}}function de(){N.fillStyle="rgb(255,255,255)",N.font="50px 'Courier New'",N.textAlign="center",b(`${I}`,1600,60,"center"),b("COMBO",1600,120,"center"),b(`Point: ${(I/c.value.notes.length*1e5).toFixed(0)}`,3150,60,"right"),b(`Music: ${(i.value/c.value.length*100).toFixed(2)}%`,3150,120,"right");{let e=B.length,t=new d(255,0,255);e/f>=0&&(t=new d(255,0,255)),e/f>.3&&(t=new d(255,0,63)),e/f>.6&&(t=new d(255,0,0)),e/f>.9&&(t=new d(255,127,0)),e/f>.95&&(t=new d(255,255,0)),e/f>.999&&(t=new d(0,255,0)),e/f>.99999&&(t=new d(0,255,255)),b(`TPS: ${e.toFixed(0)}/${f}`,3150,180,"right",50,t),b(`Sec: ${i.value.toFixed(3)} Paused: ${z.toFixed(3)} Total: ${((Date.now()-P.value)/1e3).toFixed(3)} Music: ${v.actx.currentTime.toFixed(3)}`,3150,240,"right")}}function pe(){m.clear()}Be(async()=>{document.getElementById("canvas_box").style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P4DwQACfsD/Z8fLAAAAAAASUVORK5CYII=)",N=document.getElementById("main_canvas").getContext("2d"),m=new Ne(N),m.setBackGroundColor("rgba(0,0,0,0.5)"),m.clear(),b("游戏正在加载",1600,900,"center",200,new d(200,200,200)),w.on("hit",()=>{I++}),w.on("hit",()=>{$.play()}),w.on("tick",()=>{let t=Date.now();for(B.push(t);t-B[0]>=1e3;)B.splice(0,1)}),w.on("start",()=>{P.value=Date.now()-v.actx.currentTime*1e3}),m.clear(),b("加载中",1600,900,"center",200,new d(250,250,250)),$=new $e(Ue),await v.actx.suspend(),await $.load(),await v.load(Ve),v.setVolume(ie),$.setVolume(le),w.on("start",()=>{setInterval(function(){if(U.value){z=(Date.now()-P.value)/1e3-i.value;return}pe(),i.value=(Date.now()-P.value)/1e3-z,w.emit("tick",i.value),c.value.animationNotes.forEach(t=>{t.a==12&&i.value-t.aa>t.hi?(t.a=0,t.aa=0):Math.abs(t.h-i.value)<=1.5/f?t.ho&&(t.a=11,t.aa=i.value):t.hi!=null&&Math.abs(t.h-t.p.spd-t.hi-i.value)<=1.5/f&&(t.a=12,t.aa=i.value),Y(t),Z(t)}),c.value.notes.forEach(t=>{re(t)}),c.value.notes.forEach(t=>{!t.a&&Math.abs(t.h-i.value)<1.5/f?(t.a=1,t.aa=t.h,w.emit("hit",1)):i.value-t.h>.16&&!t.a&&(t.a=-1,w.emit("miss",null)),Y(t)}),c.value.notes.forEach(t=>{Z(t)}),de(),i.value>=ue.value.length&&(L.value=0)},1e3/f)}),m.clear(),await v.actx.resume(),v.play(0),w.emit("start",null)});const L=O({get:()=>i.value,set:e=>{c.value.notes.forEach(t=>{t.a=0,t.aa=0}),c.value.animationNotes.forEach(t=>{t.a=0,t.aa=0}),I=0,c.value.notes.forEach(t=>{t.h<e&&I++}),v.pause(),P.value=Date.now()-e*1e3,z=0,i.value=e,U||v.play(e)}});function T(e){if(e instanceof k)return{type:"static",pos:[e.x,e.y],spd:e.spd};if(e instanceof F)return{type:"line",f:[e.fx,e.fy],t:[e.tx,e.ty],spd:e.spd};if(e instanceof H)return{type:"arc",c:[e.cx,e.cy],f:[e.fromx,e.fromy],t:[e.tox,e.toy],spd:e.spd};if(e instanceof W)return{type:"pow2",p:T(e.p),f:e.f,t:e.t}}function he(e){if(e.y=="I"){let t={h:0,paths:[],track:void 0,type:"I"};return t.h=e.h,e.p.ps.forEach(a=>{t.paths.push(T(a))}),t.track=e.t,t}else{let t={h:0,paths:[],track:void 0,type:"A",al:void 0};return t.h=e.h,e.p.ps.forEach(a=>{t.paths.push(T(a))}),t.track=e.t,t.al=e.al,t}}function _e(e){if(e.y=="I"){let t={h:0,paths:[],type:"I"};return t.h=e.h,e.p.ps.forEach(a=>{t.paths.push(T(a))}),t}else{let t={h:0,paths:[],type:"A",al:void 0};return t.h=e.h,e.p.ps.forEach(a=>{t.paths.push(T(a))}),t.al=e.al,t}}const q=O({get:()=>{let e={animationNotes:[],length:0,notes:[]};return c.value.notes.forEach(t=>{e.notes.push(he(t))}),c.value.animationNotes.forEach(t=>{e.animationNotes.push(_e(t))}),e.length=c.value.length,e},set:e=>{c.value=new ae(e)}}),ee=O({get:()=>JSON.stringify(q.value),set:e=>{q.value=JSON.parse(e)}});function fe(){let e=URL.createObjectURL(Q.value.files[0]);console.log(e),X.value.style.backgroundImage=`url(${e})`}function ve(){let e=URL.createObjectURL(K.value.files[0]);console.log(e),v.load(e)}function me(e,t){let a=e.target.value;t.f=[parseInt(a.slice(1,3),16),parseInt(a.slice(3,5),16),parseInt(a.slice(5,7),16)]}function ye(e){if(e=="none")return"<<CURRENTLY NONE>>";if(e.startsWith("N"))return`Note ${parseInt(e.slice(1))+1}`;if(e.startsWith("AN"))return`Animation Note ${parseInt(e.slice(2))+1}`}function A(e){if(e=="none")return null;if(e.startsWith("N"))return c.value.notes[parseInt(e.slice(1))];if(e.startsWith("AN"))return c.value.animationNotes[parseInt(e.slice(2))]}function ge(e){if(e instanceof k)return"static";if(e instanceof F)return"line";if(e instanceof H)return"arc";if(e instanceof W)return"pow2";throw new Error("Invalid Path")}function we(e,t){let a=t.target.value,l=A(y.value).p.ps[e].spd,o=new k(l,1600,900);a=="static"&&(o=new k(l,1600,900)),a=="line"&&(o=new F(l,0,0,1600,900)),a=="arc"&&(o=new H(l,0,0,-1600,900,1600,900)),a=="pow2"&&(o=new W(new k(l,1600,900))),A(y.value).p.ps[e]=o}function ke(){M=A(y.value).h;let e=A(y.value).p.spd;U.value=!1,L.value=M-e}w.on("tick",e=>{e>M&&(U.value=!0,M=1e5)});function xe(){c.value.notes.push(new ne(new oe([new k(1e-4,1600,900)]),0,"A","I",0))}function be(){c.value.animationNotes.push(new ne(new oe([new k(1e-4,1600,900)]),0,"M","I",0,[64,64,64]))}function Ae(){A(y.value).p.ps.push(new k(1e-4,1600,900))}return(e,t)=>(h(),p("div",{id:"gameBox",ref_key:"gamebox",ref:ce},[n("div",De,[n("div",{id:"canvas_box",ref_key:"canvasbox",ref:X},He,512),C.value=="N"?(h(),p("ul",Oe,[(h(!0),p(V,null,G(c.value.notes,(a,l)=>(h(),p("li",{class:se({selected:y.value==`N${l}`}),onClick:o=>y.value=`N${l}`},[(h(),p("svg",je,[n("circle",{r:"2.2em",cx:"2.5em",cy:"2.5em",fill:`rgb(${a.f[0]},${a.f[1]},${a.f[2]})`,"stroke-width":"0"},null,8,We),Ge])),n("span",Je,"Note #"+R(l+1),1),Ke,u(n("select",{class:"noteTrackInput","onUpdate:modelValue":o=>a.t=o},Ze,8,Qe),[[te,a.t]]),qe,et,n("input",{type:"checkbox",class:"noteIfClack",checked:a.y=="A",onChange:o=>{a.y=o.target.checked?"A":"I"}},null,40,tt),a.y=="A"?(h(),p("span",at,"Clack Length")):x("",!0),a.y=="A"?u((h(),p("input",{key:1,class:"noteClackTimeInput","onUpdate:modelValue":o=>a.al=o,type:"text"},null,8,nt)),[[r,a.al,void 0,{number:!0}]]):x("",!0),u(n("input",{class:"noteHitTimeInput","onUpdate:modelValue":o=>a.h=o,type:"text"},null,8,ot),[[r,a.h,void 0,{number:!0}]]),n("span",{class:"noteDelete",onClick:o=>c.value.notes.splice(l,1)},"X",8,st)],10,Re))),256)),n("li",{id:"add",onClick:xe}," + ")])):x("",!0),C.value=="AN"?(h(),p("ul",lt,[(h(!0),p(V,null,G(c.value.animationNotes,(a,l)=>(h(),p("li",{class:se({selected:y.value==`AN${l}`}),onClick:o=>y.value=`AN${l}`},[(h(),p("svg",ut,[n("circle",{r:"2.2em",cx:"2.5em",cy:"2.5em",fill:`rgb(${a.f[0]},${a.f[1]},${a.f[2]})`,"stroke-width":"0"},null,8,ct),rt])),n("span",dt,"Animation Note #"+R(l+1),1),pt,n("input",{class:"noteFillInput",type:"color",value:`#${a.f[0].toString(16)}${a.f[1].toString(16)}${a.f[2].toString(16)}`,onChange:o=>{me(o,a)}},null,40,ht),_t,u(n("input",{class:"noteHitTimeInput","onUpdate:modelValue":o=>a.h=o,type:"text"},null,8,ft),[[r,a.h,void 0,{number:!0}]]),n("span",{class:"noteDelete",onClick:o=>c.value.animationNotes.splice(l,1)},"X",8,vt)],10,it))),256)),n("li",{id:"add",onClick:be}," + ")])):x("",!0),C.value=="PE"?(h(),p("ul",mt,[(h(!0),p(V,null,G(A(y.value).p.ps,(a,l)=>(h(),p("li",null,[n("span",yt,"Path #"+R(l+1),1),gt,n("select",{class:"pathTrackInput",value:ge(a),onChange:o=>we(l,o)},Ct,40,wt),a instanceof J(k)?(h(),p(V,{key:0},[n("div",Ut,[_(" ( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.x=o,type:"text"},null,8,Vt),[[r,a.x,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.y=o,type:"text"},null,8,Nt),[[r,a.y,void 0,{number:!0,lazy:!0}]]),_(" ) ")]),It,u(n("input",{class:"noteHitTimeInput","onUpdate:modelValue":o=>a.spd=o,type:"text"},null,8,Pt),[[r,a.spd,void 0,{number:!0,lazy:!0}]])],64)):x("",!0),a instanceof J(F)?(h(),p(V,{key:1},[n("div",Tt,[_(" ( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.fx=o,type:"text"},null,8,Et),[[r,a.fx,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.fy=o,type:"text"},null,8,$t),[[r,a.fy,void 0,{number:!0,lazy:!0}]]),_(" )->( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.tx=o,type:"text"},null,8,St),[[r,a.tx,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.ty=o,type:"text"},null,8,Bt),[[r,a.ty,void 0,{number:!0,lazy:!0}]]),_(" ) ")]),zt,u(n("input",{class:"noteHitTimeInput","onUpdate:modelValue":o=>a.spd=o,type:"text"},null,8,Mt),[[r,a.spd,void 0,{number:!0,lazy:!0}]])],64)):x("",!0),a instanceof J(H)?(h(),p(V,{key:2},[n("div",Lt,[_(" ( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.fromx=o,type:"text"},null,8,Dt),[[r,a.fromx,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.fromy=o,type:"text"},null,8,Ft),[[r,a.fromy,void 0,{number:!0,lazy:!0}]]),_(" )-( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.cx=o,type:"text"},null,8,Ht),[[r,a.cx,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.cy=o,type:"text"},null,8,Ot),[[r,a.cy,void 0,{number:!0,lazy:!0}]]),_(" )>( "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.tox=o,type:"text"},null,8,Rt),[[r,a.tox,void 0,{number:!0,lazy:!0}]]),_(" , "),u(n("input",{class:"pathPositionInput","onUpdate:modelValue":o=>a.toy=o,type:"text"},null,8,jt),[[r,a.toy,void 0,{number:!0,lazy:!0}]]),_(" ) ")]),Wt,u(n("input",{class:"noteHitTimeInput","onUpdate:modelValue":o=>a.spd=o,type:"text"},null,8,Gt),[[r,a.spd,void 0,{number:!0,lazy:!0}]])],64)):x("",!0),n("span",{class:"noteDelete",onClick:o=>A(y.value).p.ps.splice(l,1)},"X",8,Jt)]))),256)),n("li",{id:"add",onClick:Ae}," + ")])):x("",!0),n("div",Kt,[Qt,u(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>L.value=a)},null,512),[[r,L.value,void 0,{lazy:!0}]]),Xt,Yt,u(n("input",{id:"pause",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>U.value=a)},null,512),[[Ce,U.value]]),Zt,qt,u(n("textarea",{id:"chartArea","onUpdate:modelValue":t[2]||(t[2]=a=>ee.value=a)},null,512),[[r,ee.value,void 0,{lazy:!0}]]),ea,ta,n("input",{type:"file",accept:"audio/*",ref_key:"music",ref:K,onChange:ve},null,544),aa,na,n("input",{type:"file",accept:"image/*",ref_key:"bg",ref:Q,onChange:fe},null,544),oa,sa,u(n("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>C.value=a)},ca,512),[[te,C.value,void 0,{lazy:!0}]]),ra,n("span",null,"Current: "+R(ye(y.value)),1),da,C.value=="PE"?(h(),p("button",{key:0,onClick:ke},"Preview")):x("",!0),pa])])],512))}});const xa=Le(ha,[["__scopeId","data-v-151a7ee4"]]);export{xa as default};
