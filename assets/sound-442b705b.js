var i=Object.defineProperty;var u=(s,t,e)=>t in s?i(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(u(s,typeof t!="symbol"?t+"":t,e),e);class a{constructor(t){o(this,"actx");o(this,"audioBuffer");o(this,"volume",1);o(this,"url","about:blank");o(this,"startTime",0);o(this,"source");this.actx=t,this.source=this.actx.createBufferSource()}play(t){this.startTime=Date.now()-t,this.source=this.actx.createBufferSource();let e=this.actx.createGain();this.source.buffer=this.audioBuffer,this.source.loop=!1,this.source.connect(e),this.source.start(0,t),e.gain.value=this.volume,e.connect(this.actx.destination),console.log(`[sound.ts/EnhancedAudioContext] Audio '${this.url}' played.`),console.debug(this.source,e,this.actx,this.audioBuffer)}pause(){try{this.source.stop()}catch(t){console.error(t)}}async init(t){let e=this;return this.pause(),this.actx.decodeAudioData(t,function(n){e.audioBuffer=n})}async load(t){return this.url=t,this.pause(),fetch(t).then(e=>e.arrayBuffer()).then(e=>this.init(e)).then(e=>console.log(`[sound.ts/EnhancedAudioContext] Audio '${t}' loaded.`))}setVolume(t){this.volume=t}}class h{constructor(t,e=16){o(this,"enhancedAudioContexts",[]);o(this,"url");o(this,"num");o(this,"loaded",!1);this.url=t,this.num=e}async load(){if(this.loaded)throw Error("Already loaded.");this.loaded=!0;for(let t=0;t<this.num;t++)this.enhancedAudioContexts.push(new a(new AudioContext)),await this.enhancedAudioContexts[t].load(this.url),console.log(`[sound.ts/SoundManager] Audio '${this.url}' loaded for #${t+1}/${this.num}`)}play(){console.debug(this.enhancedAudioContexts);for(let t=0;t<this.num;t++)if(Date.now()-this.enhancedAudioContexts[t].startTime>this.enhancedAudioContexts[t].audioBuffer.length/this.enhancedAudioContexts[t].audioBuffer.sampleRate){this.enhancedAudioContexts[t].play(0),console.log(`[sound.ts/SoundManager] Audio '${this.url}' played for #${t+1}/${this.num}`);return}}setVolume(t){for(let e=0;e<this.num;e++)this.enhancedAudioContexts[e].setVolume(t)}}export{a as EnhancedAudioContext,h as SoundManager};
