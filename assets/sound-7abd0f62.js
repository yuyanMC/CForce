var i=Object.defineProperty;var a=(n,t,e)=>t in n?i(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>(a(n,typeof t!="symbol"?t+"":t,e),e);class u{constructor(t){o(this,"actx");o(this,"audioBuffer");o(this,"volume");o(this,"url","about:blank");o(this,"startTime",0);this.actx=t}play(){this.startTime=Date.now();let t=this.actx.createBufferSource(),e=this.actx.createGain();t.buffer=this.audioBuffer,t.loop=!1,t.connect(e),t.start(0),e.gain.value=this.volume,e.connect(this.actx.destination),console.log(`[sound.ts/EnhancedAudioContext] Audio '${this.url}' played.`),console.debug(t,e,this.actx,this.audioBuffer)}async init(t){let e=this;return this.actx.decodeAudioData(t,function(s){e.audioBuffer=s})}async load(t){return this.url=t,fetch(t).then(e=>e.arrayBuffer()).then(e=>this.init(e)).then(e=>console.log(`[sound.ts/EnhancedAudioContext] Audio '${t}' loaded.`))}setVolume(t){this.volume=t}}class h{constructor(t,e=16){o(this,"enhancedAudioContexts",[]);o(this,"url");o(this,"num");o(this,"loaded",!1);this.url=t,this.num=e}async load(){if(this.loaded)throw Error("Already loaded.");this.loaded=!0;for(let t=0;t<this.num;t++)this.enhancedAudioContexts.push(new u(new AudioContext)),await this.enhancedAudioContexts[t].load(this.url),console.log(`[sound.ts/SoundManager] Audio '${this.url}' loaded for #${t+1}/${this.num}`)}play(){console.debug(this.enhancedAudioContexts);for(let t=0;t<this.num;t++)if(Date.now()-this.enhancedAudioContexts[t].startTime>this.enhancedAudioContexts[t].audioBuffer.length/this.enhancedAudioContexts[t].audioBuffer.sampleRate){this.enhancedAudioContexts[t].play(),console.log(`[sound.ts/SoundManager] Audio '${this.url}' played for #${t+1}/${this.num}`);return}}setVolume(t){for(let e=0;e<this.num;e++)this.enhancedAudioContexts[e].setVolume(t)}}export{u as EnhancedAudioContext,h as SoundManager};
